<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام دواء-لينك المتكامل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        
        :root {
            --main-green: #28a745;
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --accent-yellow: #ffc107;
            --text-gray: #b3b3b3;
        }

        body { font-family: 'Cairo', sans-serif; background: var(--dark-bg); color: white; margin: 0; display: flex; overflow-x: hidden; }

        /* --- القائمة الجانبية --- */
        .sidebar { width: 260px; background: var(--card-bg); height: 100vh; border-left: 1px solid #333; padding: 20px; position: fixed; z-index: 1000; }
        .sidebar h2 { color: var(--main-green); text-align: center; margin-bottom: 5px; }
        .sidebar p.honor { font-size: 0.8rem; color: var(--accent-yellow); text-align: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }

        .nav-item { padding: 12px 15px; margin: 8px 0; cursor: pointer; border-radius: 8px; transition: 0.3s; display: flex; align-items: center; color: var(--text-gray); }
        .nav-item:hover, .nav-item.active { background: #2a2a2a; color: var(--main-green); }
        .nav-item i { margin-left: 15px; width: 20px; }

        /* --- المحتوى الرئيسي --- */
        .main-content { margin-right: 280px; padding: 30px; width: calc(100% - 280px); transition: 0.3s; }
        .main-content.with-cart { margin-left: 320px; width: calc(100% - 600px); }

        /* --- سلة المشتريات (للسوق فقط) --- */
        .cart-sidebar { width: 320px; background: #1a1a1a; height: 100vh; position: fixed; left: 0; top: 0; border-right: 1px solid #333; padding: 20px; display: none; flex-direction: column; z-index: 999; }
        .cart-title { color: var(--main-green); border-bottom: 2px solid var(--main-green); padding-bottom: 10px; margin-bottom: 20px; }
        .cart-items { flex-grow: 1; overflow-y: auto; }
        .cart-item { background: #252525; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 0.85rem; border-right: 3px solid var(--main-green); }
        
        /* --- البطاقات والجداول --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 15px; border-bottom: 4px solid var(--main-green); text-align: center; }
        
        .table-container { background: var(--card-bg); padding: 20px; border-radius: 15px; margin-top: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #333; }
        th { color: var(--main-green); background: #252525; }

        /* --- الأزرار --- */
        .btn { padding: 10px 18px; border-radius: 8px; border: none; cursor: pointer; font-family: 'Cairo'; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--main-green); color: white; }
        .btn-print { background: #17a2b8; color: white; }
        .btn-delete { background: #ff4d4d; color: white; padding: 5px 10px; font-size: 0.8rem; }
        .btn-checkout { background: var(--accent-yellow); color: black; width: 100%; margin-top: 10px; }

        /* --- الحالات والبحث --- */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; }
        .badge-paid { background: #28a74522; color: #28a745; border: 1px solid #28a745; }
        .search-bar { background: var(--card-bg); border: 1px solid #333; padding: 10px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; }
        .search-bar input { background: transparent; border: none; color: white; width: 100%; outline: none; font-family: 'Cairo'; margin-right: 10px; }

        /* --- النوافذ المنبثقة --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 15px; width: 380px; }
        .modal-content input { width: 94%; padding: 10px; margin: 10px 0; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 8px; }

        .hidden { display: none; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .product-card { background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid #333; text-align: center; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>دواء-لينك</h2>
        <p class="honor">بإشراف . جمال فضل </p>
        <p style="text-align: center;">دكتور/ <span id="userName" style="color: var(--main-green);"></span></p>
        <hr style="border: 0.5px solid #333;">
        
        <div class="nav-item active" onclick="showPage('dashboard', this)"><i class="fas fa-home"></i> الرئيسية</div>
        <div class="nav-item" onclick="showPage('inventory', this)"><i class="fas fa-boxes"></i> إدارة المخزن</div>
        <div class="nav-item" onclick="showPage('market', this)"><i class="fas fa-search-plus"></i> سوق الجملة</div>
        <div class="nav-item" onclick="showPage('invoices', this)"><i class="fas fa-file-invoice-dollar"></i> فواتيري</div>
        
        <a href="login.html" class="nav-item" style="color: #ff4d4d; margin-top: 40px;"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a>
    </div>

    <div id="dashboardPage" class="main-content">
        <h1>لوحة القيادة السحابية</h1>
        <div class="stats-grid">
            <div class="stat-card"><i class="fas fa-pills" style="font-size: 30px; color: var(--main-green);"></i><h3>1,420</h3><p>صنف مخزن</p></div>
            <div class="stat-card" style="border-color: var(--accent-yellow);"><i class="fas fa-exclamation-triangle" style="font-size: 30px; color: var(--accent-yellow);"></i><h3>8</h3><p>نواقص عاجلة</p></div>
            <div class="stat-card" style="border-color: #17a2b8;"><i class="fas fa-file-invoice" style="font-size: 30px; color: #17a2b8;"></i><h3>25</h3><p>فاتورة هدا الشهر</p></div>
        </div>
        <div class="table-container">
            <h3>أدوية قاربت على الانتهاء</h3>
            <table>
                <tr><th>اسم الدواء</th><th>الكمية</th><th>تاريخ الانتهاء</th></tr>
                <tr><td>أوميبرازول 20 ملجم</td><td>5 علب</td><td style="color: var(--accent-yellow);">2026/05</td></tr>
                <tr><td>أوجمنتين 1 جرام</td><td>2 علب</td><td style="color: var(--accent-yellow);">2026/02</td></tr>
            </table>
        </div>
    </div>

    <div id="inventoryPage" class="main-content hidden">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>إدارة مخزن الصيدلية</h1>
            <button class="btn btn-add" onclick="toggleModal()"><i class="fas fa-plus"></i> إضافة صنف للمخزن</button>
        </div>
        <div class="table-container">
            <table id="inventoryTable">
                <thead><tr><th>الدواء</th><th>الكمية</th><th>السعر</th><th>الإجراء</th></tr></thead>
                <tbody>
                    <tr><td>بندول إكسترا</td><td>100 علبة</td><td>500 ريال</td><td><button class="btn btn-delete" onclick="this.parentElement.parentElement.remove()">حذف</button></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="marketPage" class="main-content hidden">
        <h1>سوق الجملة المفتوح</h1>
        <div class="search-bar"><i class="fas fa-search"></i><input type="text" placeholder="بحث في سوق الجملة..."></div>
        <div class="product-grid">
            <div class="product-card">
                <h4>بندول إكسترا</h4>
                <p style="color: var(--main-green);">4,500 ريال / شدة</p>
                <input type="number" value="1" min="1" id="q1" style="width: 50px; background: #333; color: white; border: none; padding: 5px; border-radius: 4px;">
                <button class="btn btn-add" style="width: 100%; margin-top: 10px;" onclick="addToCart('بندول إكسترا', 4500, 'q1')">طلب</button>
            </div>
            <div class="product-card">
                <h4>أوجمنتين 1 جم</h4>
                <p style="color: var(--main-green);">8,200 ريال / شدة</p>
                <input type="number" value="1" min="1" id="q2" style="width: 50px; background: #333; color: white; border: none; padding: 5px; border-radius: 4px;">
                <button class="btn btn-add" style="width: 100%; margin-top: 10px;" onclick="addToCart('أوجمنتين 1 جم', 8200, 'q2')">طلب</button>
            </div>
        </div>
    </div>

    <div id="invoicesPage" class="main-content hidden">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>سجل الفواتير والطلبات</h1>
            <button class="btn btn-print" onclick="window.print()"><i class="fas fa-print"></i> طباعة كشف</button>
        </div>
        <div class="table-container">
            <table>
                <thead><tr><th>رقم الفاتورة</th><th>المورد</th><th>التاريخ</th><th>الإجمالي</th><th>الحالة</th></tr></thead>
                <tbody>
                    <tr><td>#INV-990</td><td>شركة شفا فارما</td><td>2026/01/01</td><td>45,000 ريال</td><td><span class="badge badge-paid">مدفوعة</span></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="cartSidebar" class="cart-sidebar">
        <h3 class="cart-title"><i class="fas fa-shopping-basket"></i> سلة الطلب</h3>
        <div class="cart-items" id="cartContent"></div>
        <div class="total-section" style="border-top: 1px solid #333; padding-top: 10px;">
            <div style="display: flex; justify-content: space-between;"><span>الإجمالي:</span><span id="grandTotal" style="color: var(--main-green);">0 ريال</span></div>
            <button class="btn btn-checkout" onclick="sendToWhatsApp()"><i class="fab fa-whatsapp"></i> إرسال للمورد</button>
        </div>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <h3 style="color: var(--main-green);">إضافة دواء جديد للمخزن</h3>
            <input type="text" id="m_name" placeholder="اسم الدواء">
            <input type="text" id="m_qty" placeholder="الكمية">
            <input type="text" id="m_price" placeholder="سعر البيع">
            <button class="btn btn-add" style="width: 100%;" onclick="saveMedicine()">حفظ في المخزن</button>
            <button class="btn" style="width: 100%; background: #444; color: white; margin-top: 10px;" onclick="toggleModal()">إلغاء</button>
        </div>
    </div>

    <script>
        let cart = [];

        function showPage(pageId, element) {
            document.querySelectorAll('.main-content').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            element.classList.add('active');

            const cartSide = document.getElementById('cartSidebar');
            const mainCont = document.getElementById(pageId + 'Page');
            if(pageId === 'market') {
                cartSide.style.display = 'flex';
                mainCont.classList.add('with-cart');
            } else {
                cartSide.style.display = 'none';
                mainCont.classList.remove('with-cart');
            }
        }

        function toggleModal() {
            const m = document.getElementById('addModal');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        function saveMedicine() {
            const name = document.getElementById('m_name').value;
            const qty = document.getElementById('m_qty').value;
            const price = document.getElementById('m_price').value;
            if(name && qty) {
                const table = document.getElementById('inventoryTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                row.innerHTML = `<td>${name}</td><td>${qty}</td><td>${price}</td><td><button class="btn btn-delete" onclick="this.parentElement.parentElement.remove()">حذف</button></td>`;
                toggleModal();
            }
        }

        function addToCart(name, price, qId) {
            let qty = parseInt(document.getElementById(qId).value);
            cart.push({ name, price, qty, total: price * qty });
            updateCart();
        }

        function updateCart() {
            const content = document.getElementById('cartContent');
            const totalDisplay = document.getElementById('grandTotal');
            content.innerHTML = '';
            let total = 0;
            cart.forEach((item, i) => {
                total += item.total;
                content.innerHTML += `<div class="cart-item"><strong>${item.name}</strong><div><span>${item.qty} × ${item.price}</span><span>${item.total}</span></div></div>`;
            });
            totalDisplay.innerText = total.toLocaleString() + " ريال";
        }

        function sendToWhatsApp() {
            if(cart.length === 0) return alert("السلة فارغة!");
            let msg = "طلب شراء جديد:\n";
            cart.forEach(item => msg += `- ${item.name} (${item.qty})\n`);
            window.open(`https://wa.me/967770000000?text=${encodeURIComponent(msg)}`, '_blank');
        }

        document.getElementById('userName').innerText = localStorage.getItem('pharmacistName') || "المستخدم";
    </script>
</body>
</html>